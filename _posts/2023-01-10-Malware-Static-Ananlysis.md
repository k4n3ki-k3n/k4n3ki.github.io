---
title: Malware Static Analysis
author: k4n3ki
date: 2023-01-10 2:4:00 -500
categories: [Malware, Rev]
tags: [Tutorial]
---


## <span style = "color:red;">What is Malware Analysis?</span>
The purpose of malware analysis is usually to understand the purpose and behavior of suspicious binary or file.

Goals of malware analysis will typically be:
* to gather information to respond to the intrusion
* to determine exactly what happened
* to ensure that you've located all the infected files
* what the binary can do, how to detect it, how to mesaure and contain its damge

## <span style = "color:red;">Types of malware analysis</span>
![categoryImg](https://raw.githubusercontent.com/0xk4n3ki/CTF-Write-ups/main/static%20analysis/categoryImg.png?token=GHSAT0AAAAAAB45ISCN5VBLMQMT65LHU7MGY55KXSA)

<span style = "color:lightgreen;">**Static Analysis**</span> involes examining the malware without running it.

<span style = "color:lightgreen;">**Dynamic Analysis**</span> involes running the malware and observe its behavior.

<span style = "color:lightblue;">**Basic Static analysis**</span> can confirm whether a file is malicious, provide information about its functionality, adn sometimes provide information that will allow you to produce simple network signatures. it is straightforward and can be quick, but it is largley ineffective against sophisticated malware, and it can miss important behaviors.

<span style = "color:lightblue;">**Advanced Static analysis**</span> consists of reversing the malware's internals by loading the binary into disassembler and looking at the program instructions in order to discover what the program does.

In this post, we will focus on <span style = "color:red;">Basic Static techniques</span> only.

We'll discuss techniques one by one.

## <span style = "color:red;">Antivirus Scanning: A useful first step</span>
First step is to run the the binary through multiple antivirus programs. 
These antivirus programs depends on database that contains same pieces of *file signatures* and behavioral and pattern-matching analysis to indentify suspect files.

There are nice websites that allow you to upload a file for scanning by mulltiple antivirus engines:
* [VirusTotal](https://www.virustotal.com/gui/home/upload)
* [Intezer Analyze](https://analyze.intezer.com/)
* [Hybrid Analysis](https://www.hybrid-analysis.com/)

## <span style = "color:red;">Hashing: A fingerprint for malware</span>
Hasing is common method used to uniquesly identify malware. There are many hashing algorithms that generate hash like <span style= "color:pink;">Message-Digest Algorith(MD5)</span>, <span style= "color:pink;">Secure Hash Algorithm(SHA-1)</span>, and many more.

## <span style = "color:red;">Finding Strings</span>
A program contains strings if it prints a message, connects to a URL, or copies a file to a specific location, including DLLs, and any much more information.

## <span style = "color:red;">Detecting Packers with PEiD</span>
Malware writers usually use packing or obfuscation to make their files more difficult to analyze or detect. Programs with few strings are either obfuscated or packed.

> Packed or obfuscated code will often include at least the functions *LoadLibrary* and *GetProcAddress*, which are used to load and gain access to additional functions.

You can use [PEiD](https://www.aldeid.com/wiki/PEiD) to detect the type of packer or compiler employed to build an application.

## <span style = "color:red;">PE File Format</span>
The Portable Executable(PE) file format is used by Windows executables, object code, and DLLs. PE files begin with a header that includes information about the code. PE file header stores information about every library that will be loaded and every function that will be used by the program.

PE header can be examined through [PEview](https://www.aldeid.com/wiki/PEView)
![peview](https://raw.githubusercontent.com/0xk4n3ki/CTF-Write-ups/main/static%20analysis/peview.png?token=GHSAT0AAAAAAB45ISCMHGKTQWHB27YMPVLCY55KYGA)

## <span style = "color:red;">Linked libraries and Functions</span>
Imports are functions used by one program that are actually stored in a different program, such as code libraries that contain functionality common to many programs. Code libraries can be connected to the main executable by linking.

[Dependency Walker](https://www.dependencywalker.com/) program lists dynamically linked functions in an executable.

![dependencyWalker](https://raw.githubusercontent.com/0xk4n3ki/CTF-Write-ups/main/static%20analysis/dependencyWalker.png?token=GHSAT0AAAAAAB45ISCM6DSDN5OY3QC7CH4MY55KYQQ)

The libraries used and functions called are often the most important parts of the program, and identifying them is particularly important, as it allows us to guess what the program does.

> We can see the Documentation of Windows API on Microsoft Developer Network([MSDN](https://learn.microsoft.com/en-us/windows/win32/apiindex/windows-api-list)) Library.

## <span style = "color:red;">Viewing resource section with Resource Hacker</span>
[Resource Hacker](http://www.angusj.com/resourcehacker/) can show all the resources included in the executable. Resources like menus, icons, Version info, Dialog, etc.

![resourceHacker](https://raw.githubusercontent.com/0xk4n3ki/CTF-Write-ups/main/static%20analysis/resourceHacker.jpg?token=GHSAT0AAAAAAB45ISCNX5AY3ZT5XS5BROSCY55KY4A)
