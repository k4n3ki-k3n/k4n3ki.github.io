---
title : Malware Behavior
author : k4n3ki
date : 2023-02-21 1:00:00 -500
categories: [Malware]
tags: [Tutorial]
---

# <span style = "color:red;">**Malware Behavior**</span>

There are many types of malware that behave differently on target device. On the basis of their behavior we can recognize a variety of malicious files.

## <span style = "color:red;">**Downloader**</span>
- Downloaders simply download another piece of malware from the internet and execute it on the local system. 
- They generally use <span style="color:blue"> *URLDownloadtoFileA* </span> followed by a call to <span style="color:blue">*WinExec*</span> to download and execute new file.

## <span style = "color:red;">**Launcher**</span>
- Launcher/Loader contains the malware and installs it for immediate or future covert execution.

## <span style = "color:red;">**Backdoor**</span>
- It provides and attacker with remote access to victim's machine. 
- It communicate over the internet, commonly over port 80 using HTTP protocol. 
- Common functionalities are ability to <span style="color:blue">manipulate registry keys</span>, <span style="color:blue">enumerate display windows</span>, <span style="color:blue">create directories</span>, <span style="color:blue">search files</span> and many more.

## <span style = "color:red;">**Reverse Shell**</span>
- It provides shell access to the infected machine, then attackers can execute commands as if they were on local system.

## <span style = "color:red;">**Windows Revers Shell**</span>
- Two methods : basic and multithreaded. 
  - Basic method involes a call to <span style="color:blue">*CreateProcess*</span> and manipulation of the <span style="color:blue">STARTUPINFO</span> Structure tha tis passed to CreateProcess. First, a <span style="color:blue">socket</span> is created and a connection to a remote server is established. That socket is tied to the standard streams for <span style="color:blue">cmd.exe</span>. CreateProcess runs cmd.exe with its window supressed, to hide it from the victim. 

  - Multithreaded version involves the creation of a socket, two pipes, and two threads(look for <span style="color:blue">*CreateThread*</span> and <span style="color:blue">*CreatePipe*</span>)

## <span style = "color:red;">**Remote Administration Tool**</span>
- RATs are used to remotely manage the machine with specific goals like stealing info or moving laterally across a network. 
- Its communication is typically over common ports like 80 and 443.

## <span style = "color:red;">**Botnet**</span>
- It is a collection of compromised hosts called <span style="color:blue">zombies</span> that are contolled by a single server called <span style="color:blue">botnet controller</span>. 
- Goal is to create a large network of zombies to spread additional malware or spam, or perform a distributed DDoS.

## <span style = "color:red;">**Credential Stealers**</span>
- Attackers uses many ways to steal credentials, primary with 3 types of malwares:
  1. <span style="color:red">**GINA Interception**</span> :
       -- <span style="color:blue">Graphical Identification and Authentication</span> (GINA) system was intended to allow legitimate third parties to customize the logon process by adding support for things like authentication with hardware radio-frequency identification(RFID) tokens or smart card.
       -- GINA is implemented in a DLL, <span style="color:blue">msgina.dll</span>, and is loaded by the Winlogon executable during the login process.
       -- Winlogon also works for third-party customizations implemented in DLLs by loading them in between Winlogon and the GINA DLL(like a man-in-the-middle attack).
       -- Windows Conveniently provides the following registry location where third-party DLLs will be found and loaded by Winlogon: <span style="color:blue">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\GinaDLL</span>.
       -- The malicious DLL must export all thee functions required by GINA, most of which are prepended with <span style="color:blue">Wlx</span>.
  2. <span style="color:red">**Hash Dumping**</span> :
       -- Attackers try to Dump Windows hashes in order to  crack them offline or to use them in pass-the-hash attack.
       -- <span style="color:blue">Pwdump</span> and <span style="color:blue">Pass-the-Hash</span>(PSH) Toolkit are freely available packages that provide hash dumping.
       -- Intresting imports resolved from samsrv.dll in pwdump variants are SamIConnect, SamQueryInformationUser, and SamIGETPrivateData.
  3. <span style="color:red">**Keystroke Logging**</span> :
       
